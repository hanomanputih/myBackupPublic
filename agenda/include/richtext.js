
var richtext_included=true;var isRichText=false;var rng;var currentRTE;var allRTEs="";var isIE;var isGecko;var isSafari;var isKonqueror;var imagesPath;var includesPath;var cssFile;function initRTE(imgPath,incPath,css){var ua=navigator.userAgent.toLowerCase();isIE=((ua.indexOf("msie")!=-1)&&(ua.indexOf("opera")==-1)&&(ua.indexOf("webtv")==-1));isGecko=(ua.indexOf("gecko")!=-1);isSafari=(ua.indexOf("safari")!=-1);isKonqueror=(ua.indexOf("konqueror")!=-1);if(document.getElementById&&document.designMode){isRichText=true;}
if(!isIE)document.captureEvents(Event.MOUSEOVER|Event.MOUSEOUT|Event.MOUSEDOWN|Event.MOUSEUP);document.onmouseover=raiseButton;document.onmouseout=normalButton;document.onmousedown=lowerButton;document.onmouseup=raiseButton;imagesPath=imgPath;includesPath=incPath;cssFile=css;if(isRichText)document.writeln('<style type="text/css">@import "'+includesPath+'rte.css";</style>');}
function writeRichText(rte,html,width,height,buttons,readOnly){if(isRichText){if(allRTEs.length>0)allRTEs+=";";allRTEs+=rte;writeRTE(rte,html,width,height,buttons,readOnly);}else{writeDefault(rte,html,width,height,buttons,readOnly);}}
function writeDefault(rte,html,width,height,buttons,readOnly){if(!readOnly){document.writeln('<textarea name="'+rte+'" id="'+rte+'" style="width: '+width+'px; height: '+height+'px;">'+html+'</textarea>');}else{document.writeln('<textarea name="'+rte+'" id="'+rte+'" style="width: '+width+'px; height: '+height+'px;" readonly>'+html+'</textarea>');}}
function raiseButton(e){if(isIE){var el=window.event.srcElement;}else{var el=e.target;}
className=el.className;if(className=='rteImage'||className=='rteImageLowered'){el.className='rteImageRaised';}}
function normalButton(e){if(isIE){var el=window.event.srcElement;}else{var el=e.target;}
className=el.className;if(className=='rteImageRaised'||className=='rteImageLowered'){el.className='rteImage';}}
function lowerButton(e){if(isIE){var el=window.event.srcElement;}else{var el=e.target;}
className=el.className;if(className=='rteImage'||className=='rteImageRaised'){el.className='rteImageLowered';}}
function writeRTE(rte,html,width,height,buttons,readOnly){if(readOnly)buttons=false;if(isIE){if(buttons&&(width<600))width=600;var tablewidth=width;}else{if(buttons&&(width<500))width=500;var tablewidth=width+4;}
if(buttons==true){document.writeln('<table class="rteBack" cellpadding=2 cellspacing=0 id="Buttons1_'+rte+'" width="'+tablewidth+'">');document.writeln(' <tr>');document.writeln('  <td>');document.writeln('   <select id="formatblock_'+rte+'" onchange="Select(\''+rte+'\', this.id);">');document.writeln('    <option value="">[Style]</option>');document.writeln('    <option value="<p>">Paragraph</option>');document.writeln('    <option value="<h1>">Heading 1 <h1></option>');document.writeln('    <option value="<h2>">Heading 2 <h2></option>');document.writeln('    <option value="<h3>">Heading 3 <h3></option>');document.writeln('    <option value="<h4>">Heading 4 <h4></option>');document.writeln('    <option value="<h5>">Heading 5 <h5></option>');document.writeln('    <option value="<h6>">Heading 6 <h6></option>');document.writeln('    <option value="<address>">Address <ADDR></option>');document.writeln('    <option value="<pre>">Formatted <pre></option>');document.writeln('   </select>');document.writeln('  </td>');document.writeln('  <td>');document.writeln('   <select id="fontname_'+rte+'" onchange="Select(\''+rte+'\', this.id)">');document.writeln('    <option value="Font" selected>[Font]</option>');document.writeln('    <option value="Arial, Helvetica, sans-serif">Arial</option>');document.writeln('    <option value="Courier New, Courier, mono">Courier New</option>');document.writeln('    <option value="Times New Roman, Times, serif">Times New Roman</option>');document.writeln('    <option value="Verdana, Arial, Helvetica, sans-serif">Verdana</option>');document.writeln('   </select>');document.writeln('  </td>');document.writeln('  <td>');document.writeln('   <select unselectable="on" id="fontsize_'+rte+'" onchange="Select(\''+rte+'\', this.id);">');document.writeln('    <option value="Size">[Size]</option>');document.writeln('    <option value="1">1</option>');document.writeln('    <option value="2">2</option>');document.writeln('    <option value="3">3</option>');document.writeln('    <option value="4">4</option>');document.writeln('    <option value="5">5</option>');document.writeln('    <option value="6">6</option>');document.writeln('    <option value="7">7</option>');document.writeln('   </select>');document.writeln('  </td>');document.writeln('  <td width="100%">');document.writeln('  </td>');document.writeln(' </tr>');document.writeln('</table>');document.writeln('<table class="rteBack" cellpadding="0" cellspacing="0" id="Buttons2_'+rte+'" width="'+tablewidth+'">');document.writeln(' <tr>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'bold.gif" width="25" height="24" alt="Bold" title="Bold" onClick="FormatText(\''+rte+'\', \'bold\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'italic.gif" width="25" height="24" alt="Italic" title="Italic" onClick="FormatText(\''+rte+'\', \'italic\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'underline.gif" width="25" height="24" alt="Underline" title="Underline" onClick="FormatText(\''+rte+'\', \'underline\', \'\')"></td>');document.writeln('  <td><img class="rteVertSep" src="'+imagesPath+'blackdot.gif" width="1" height="20" border="0" alt=""></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'left_just.gif" width="25" height="24" alt="Align Left" title="Align Left" onClick="FormatText(\''+rte+'\', \'justifyleft\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'centre.gif" width="25" height="24" alt="Center" title="Center" onClick="FormatText(\''+rte+'\', \'justifycenter\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'right_just.gif" width="25" height="24" alt="Align Right" title="Align Right" onClick="FormatText(\''+rte+'\', \'justifyright\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'justifyfull.gif" width="25" height="24" alt="Justify Full" title="Justify Full" onclick="FormatText(\''+rte+'\', \'justifyfull\', \'\')"></td>');document.writeln('  <td><img class="rteVertSep" src="'+imagesPath+'blackdot.gif" width="1" height="20" border="0" alt=""></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'hr.gif" width="25" height="24" alt="Horizontal Rule" title="Horizontal Rule" onClick="FormatText(\''+rte+'\', \'inserthorizontalrule\', \'\')"></td>');document.writeln('  <td><img class="rteVertSep" src="'+imagesPath+'blackdot.gif" width="1" height="20" border="0" alt=""></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'numbered_list.gif" width="25" height="24" alt="Ordered List" title="Ordered List" onClick="FormatText(\''+rte+'\', \'insertorderedlist\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'list.gif" width="25" height="24" alt="Unordered List" title="Unordered List" onClick="FormatText(\''+rte+'\', \'insertunorderedlist\', \'\')"></td>');document.writeln('  <td><img class="rteVertSep" src="'+imagesPath+'blackdot.gif" width="1" height="20" border="0" alt=""></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'outdent.gif" width="25" height="24" alt="Outdent" title="Outdent" onClick="FormatText(\''+rte+'\', \'outdent\', \'\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'indent.gif" width="25" height="24" alt="Indent" title="Indent" onClick="FormatText(\''+rte+'\', \'indent\', \'\')"></td>');document.writeln('  <td><div id="forecolor_'+rte+'"><img class="rteImage" src="'+imagesPath+'textcolor.gif" width="25" height="24" alt="Text Color" title="Text Color" onClick="FormatText(\''+rte+'\', \'forecolor\', \'\')"></div></td>');document.writeln('  <td><div id="hilitecolor_'+rte+'"><img class="rteImage" src="'+imagesPath+'bgcolor.gif" width="25" height="24" alt="Background Color" title="Background Color" onClick="FormatText(\''+rte+'\', \'hilitecolor\', \'\')"></div></td>');document.writeln('  <td><img class="rteVertSep" src="'+imagesPath+'blackdot.gif" width="1" height="20" border="0" alt=""></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'hyperlink.gif" width="25" height="24" alt="Insert Link" title="Insert Link" onClick="FormatText(\''+rte+'\', \'createlink\')"></td>');document.writeln('  <td><img class="rteImage" src="'+imagesPath+'image.gif" width="25" height="24" alt="Add Image" title="Add Image" onClick="AddImage(\''+rte+'\')"></td>');if(isIE){document.writeln('  <td><img class="rteImage" src="'+imagesPath+'spellcheck.gif" width="25" height="24" alt="Spell Check" title="Spell Check" onClick="checkspell()"></td>');}
document.writeln('  <td width="100%"></td>');document.writeln(' </tr>');document.writeln('</table>');}
document.writeln('<iframe id="'+rte+'" name="'+rte+'" src="./include/emptypage.html" width="'+width+'px" height="'+height+'px" frameborder=\"0\" vspace=\"0\" hspace=\"0\" marginwidth=\"0\" marginheight=\"0\" style=\"border: 1px solid black\"></iframe>');if(!readOnly)document.writeln('<br /><input type="checkbox" id="chkSrc'+rte+'" onclick="toggleHTMLSrc(\''+rte+'\');" />&nbsp;'+TEXT_VIEW_SOURCE);document.writeln('<iframe width="154" height="104" id="cp'+rte+'" src="'+includesPath+'palette.htm" marginwidth="0" marginheight="0" scrolling="no" style="visibility:hidden; display: none; position: absolute;"></iframe>');document.writeln('<input type="hidden" id="hdn'+rte+'" name="'+rte+'" value="">');document.getElementById('hdn'+rte).value=html;enableDesignMode(rte,html,readOnly);}
function enableDesignMode(rte,html,readOnly){var frameHtml="<html id=\""+rte+"\">\n";frameHtml+="<head>\n";if(cssFile.length>0){frameHtml+="<link media=\"all\" type=\"text/css\" href=\""+cssFile+"\" rel=\"stylesheet\">\n";}else{frameHtml+="<style>\n";frameHtml+="body {\n";frameHtml+=" background: #FFFFFF;\n";frameHtml+=" margin: 0px;\n";frameHtml+=" padding: 0px;\n";frameHtml+="}\n";frameHtml+="</style>\n";}
frameHtml+="</head>\n";frameHtml+="<body>\n";frameHtml+=html+"\n";frameHtml+="</body>\n";frameHtml+="</html>";if(document.all){var oRTE=frames[rte].document;oRTE.open();oRTE.write(frameHtml);oRTE.close();if(!readOnly)oRTE.designMode="On";}else{try{if(!readOnly)document.getElementById(rte).contentDocument.designMode="on";try{var oRTE=document.getElementById(rte).contentWindow.document;oRTE.open();oRTE.write(frameHtml);oRTE.close();if(isGecko&&!readOnly){oRTE.addEventListener("keypress",kb_handler,true);}}catch(e){alert("Error preloading content.");}}catch(e){if(isGecko){setTimeout("enableDesignMode('"+rte+"', '"+html+"', "+readOnly+");",10);}else{return false;}}}}
function updateRTEs(){var vRTEs=allRTEs.split(";");for(var i=0;i<vRTEs.length;i++){updateRTE(vRTEs[i]);}}
function updateRTE(rte){if(!isRichText)return;var oHdnMessage=document.getElementById('hdn'+rte);var oRTE=document.getElementById(rte);var readOnly=false;if(document.all){if(frames[rte].document.designMode!="On")readOnly=true;}else{if(document.getElementById(rte).contentDocument.designMode!="on")readOnly=true;}
if(isRichText&&!readOnly){if(document.getElementById("chkSrc"+rte).checked){document.getElementById("chkSrc"+rte).checked=false;toggleHTMLSrc(rte);}
if(oHdnMessage.value==null)oHdnMessage.value="";if(document.all){oHdnMessage.value=frames[rte].document.body.innerHTML;}else{oHdnMessage.value=oRTE.contentWindow.document.body.innerHTML;}
if(stripHTML(oHdnMessage.value.replace("&nbsp;"," "))==""&&oHdnMessage.value.toLowerCase().search("<hr")==-1&&oHdnMessage.value.toLowerCase().search("<img")==-1)oHdnMessage.value="";if(escape(oHdnMessage.value)=="%3Cbr%3E%0D%0A%0D%0A%0D%0A")oHdnMessage.value="";}}
function toggleHTMLSrc(rte){var oRTE;if(document.all){oRTE=frames[rte].document;}else{oRTE=document.getElementById(rte).contentWindow.document;}
if(document.getElementById("chkSrc"+rte).checked){document.getElementById("Buttons1_"+rte).style.visibility="hidden";document.getElementById("Buttons2_"+rte).style.visibility="hidden";if(document.all){oRTE.body.innerText=oRTE.body.innerHTML;}else{var htmlSrc=oRTE.createTextNode(oRTE.body.innerHTML);oRTE.body.innerHTML="";oRTE.body.appendChild(htmlSrc);}}else{document.getElementById("Buttons1_"+rte).style.visibility="visible";document.getElementById("Buttons2_"+rte).style.visibility="visible";if(document.all){var output=escape(oRTE.body.innerText);output=output.replace("%3CP%3E%0D%0A%3CHR%3E","%3CHR%3E");output=output.replace("%3CHR%3E%0D%0A%3C/P%3E","%3CHR%3E");oRTE.body.innerHTML=unescape(output);}else{var htmlSrc=oRTE.body.ownerDocument.createRange();htmlSrc.selectNodeContents(oRTE.body);oRTE.body.innerHTML=htmlSrc.toString();}}}
function FormatText(rte,command,option){var oRTE;if(document.all){oRTE=frames[rte];var selection=oRTE.document.selection;if(selection!=null){rng=selection.createRange();}}else{oRTE=document.getElementById(rte).contentWindow;var selection=oRTE.getSelection();rng=selection.getRangeAt(selection.rangeCount-1).cloneRange();}
try{if((command=="forecolor")||(command=="hilitecolor")){parent.command=command;currentRTE=rte;buttonElement=document.getElementById(command+'_'+rte);document.getElementById('cp'+rte).style.left=getOffsetLeft(buttonElement,4)+"px";document.getElementById('cp'+rte).style.top=(getOffsetTop(buttonElement,4)+buttonElement.offsetHeight+4)+"px";if(document.getElementById('cp'+rte).style.visibility=="hidden"){document.getElementById('cp'+rte).style.visibility="visible";document.getElementById('cp'+rte).style.display="inline";}else{document.getElementById('cp'+rte).style.visibility="hidden";document.getElementById('cp'+rte).style.display="none";}}else if(command=="createlink"){var szURL=prompt("Enter a URL:","");try{oRTE.document.execCommand("Unlink",false,null);oRTE.document.execCommand("CreateLink",false,szURL);}catch(e){}}else{oRTE.focus();oRTE.document.execCommand(command,false,option);oRTE.focus();}}catch(e){alert(e);}}
function setColor(color){var rte=currentRTE;var oRTE;if(document.all){oRTE=frames[rte];}else{oRTE=document.getElementById(rte).contentWindow;}
var parentCommand=parent.command;if(document.all){var sel=oRTE.document.selection;if(parentCommand=="hilitecolor")parentCommand="backcolor";if(sel!=null){var newRng=sel.createRange();newRng=rng;newRng.select();}}
oRTE.focus();oRTE.document.execCommand(parentCommand,false,color);oRTE.focus();document.getElementById('cp'+rte).style.visibility="hidden";document.getElementById('cp'+rte).style.display="none";}
function AddImage(rte){var oRTE;if(document.all){oRTE=frames[rte];var selection=oRTE.document.selection;if(selection!=null){rng=selection.createRange();}}else{oRTE=document.getElementById(rte).contentWindow;var selection=oRTE.getSelection();rng=selection.getRangeAt(selection.rangeCount-1).cloneRange();}
imagePath=prompt('Enter Image URL:','http://');if((imagePath!=null)&&(imagePath!="")){oRTE.focus();oRTE.document.execCommand('InsertImage',false,imagePath);oRTE.focus();}}
function checkspell(){try{var tmpis=new ActiveXObject("ieSpell.ieSpellExtension");tmpis.CheckAllLinkedDocuments(document);}
catch(exception){if(exception.number==-2146827859){if(confirm("ieSpell not detected.  Click Ok to go to download page."))
window.open("http://www.iespell.com/download.php","DownLoad");}else{alert("Error Loading ieSpell: Exception "+exception.number);}}}
function getOffsetTop(elm,parents_up){var mOffsetTop=elm.offsetTop;var mOffsetParent=elm.offsetParent;if(!parents_up){parents_up=10000;}
while(parents_up>0&&mOffsetParent){mOffsetTop+=mOffsetParent.offsetTop;mOffsetParent=mOffsetParent.offsetParent;parents_up--;}
return mOffsetTop;}
function getOffsetLeft(elm,parents_up){var mOffsetLeft=elm.offsetLeft;var mOffsetParent=elm.offsetParent;if(!parents_up){parents_up=10000;}
while(parents_up>0&&mOffsetParent){mOffsetLeft+=mOffsetParent.offsetLeft;mOffsetParent=mOffsetParent.offsetParent;parents_up--;}
return mOffsetLeft;}
function Select(rte,selectname){var oRTE;if(document.all){oRTE=frames[rte];var selection=oRTE.document.selection;if(selection!=null){rng=selection.createRange();}}else{oRTE=document.getElementById(rte).contentWindow;var selection=oRTE.getSelection();rng=selection.getRangeAt(selection.rangeCount-1).cloneRange();}
var idx=document.getElementById(selectname).selectedIndex;if(idx!=0){var selected=document.getElementById(selectname).options[idx].value;var cmd=selectname.replace('_'+rte,'');oRTE.focus();oRTE.document.execCommand(cmd,false,selected);oRTE.focus();document.getElementById(selectname).selectedIndex=0;}}
function kb_handler(evt){var rte=evt.target.id;if(evt.ctrlKey){var key=String.fromCharCode(evt.charCode).toLowerCase();var cmd='';switch(key){case'b':cmd="bold";break;case'i':cmd="italic";break;case'u':cmd="underline";break;};if(cmd){FormatText(rte,cmd,true);evt.preventDefault();evt.stopPropagation();}}}
function docChanged(evt){alert('changed');}
function stripHTML(oldString){var newString=oldString.replace(/(<([^>]+)>)/ig,"");newString=newString.replace(/\r\n/g," ");newString=newString.replace(/\n/g," ");newString=newString.replace(/\r/g," ");newString=trim(newString);return newString;}
function trim(inputString){if(typeof inputString!="string")return inputString;var retValue=inputString;var ch=retValue.substring(0,1);while(ch==" "){retValue=retValue.substring(1,retValue.length);ch=retValue.substring(0,1);}
ch=retValue.substring(retValue.length-1,retValue.length);while(ch==" "){retValue=retValue.substring(0,retValue.length-1);ch=retValue.substring(retValue.length-1,retValue.length);}
while(retValue.indexOf("  ")!=-1){retValue=retValue.substring(0,retValue.indexOf("  "))+retValue.substring(retValue.indexOf("  ")+1,retValue.length);}
return retValue;}